<div class="add-new-container">
    <!-- Animated floating spheres -->
    <div class="sphere-1"></div>
    <div class="sphere-2"></div>
    <div class="sphere-3"></div>

    <mat-card class="form-card">
        <!-- <mat-card-header>
            <mat-card-title>{{ formTitle }}</mat-card-title>
            <mat-card-subtitle>{{ formSubtitle }}</mat-card-subtitle>
        </mat-card-header> -->

        <mat-card-content>
            <form [formGroup]="recordForm" (ngSubmit)="onFormSubmit($event)">
                <!-- Form Title -->
                <div class="form-section-title">{{ translationService.get('form.farmerInfo') }}</div>

                <!-- Row 1: Farmer Name & Contact -->
                <div class="form-row">
                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.farmerName') }}</mat-label>
                        <input matInput type="text" [placeholder]="translationService.get('form.farmerNamePlaceholder')" formControlName="farmerName" required />
                        <mat-icon matPrefix>person</mat-icon>
                        @if (recordForm.get('farmerName')?.invalid && recordForm.get('farmerName')?.touched) {
                        <mat-error>{{ translationService.get('errors.farmerNameRequired') }}</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.contactNumber') }}</mat-label>
                        <input matInput type="tel" [placeholder]="translationService.get('form.contactNumberPlaceholder')" formControlName="contactNumber" maxlength="10" required />
                        <mat-icon matPrefix>phone</mat-icon>
                        @if (recordForm.get('contactNumber')?.invalid && recordForm.get('contactNumber')?.touched) {
                        <mat-error>{{ translationService.get('errors.contactNumberInvalid') }}</mat-error>
                        }
                    </mat-form-field>
                </div>

                <!-- Harvester (optional) -->
                <div class="form-row">
                    <mat-form-field appearance="outline" class="form-field full-width">
                        <mat-label>{{ translationService.get('form.harvester') }}</mat-label>
                        <mat-select formControlName="harvester">
                            @for (name of harvesterService.harvesters(); track name) {
                                <mat-option [value]="name">{{ name }}</mat-option>
                            }
                        </mat-select>
                        <mat-icon matPrefix>agriculture</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Row 2: Date & Land -->
                <div class="form-row">
                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.date') }}</mat-label>
                        <input matInput [matDatepicker]="datePicker" formControlName="date" [max]="currentDate" required  />
                        <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
                        <mat-datepicker #datePicker></mat-datepicker>
                        <mat-icon matPrefix>event</mat-icon>
                        @if (recordForm.get('date')?.invalid && recordForm.get('date')?.touched) {
                        <mat-error>{{ translationService.get('errors.dateRequired') }}</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.landInAcres') }}</mat-label>
                        <input matInput type="number" [placeholder]="translationService.get('form.landInAcresPlaceholder')" formControlName="landInAcres" step="0.01" required />
                        <mat-icon matPrefix>location_on</mat-icon>
                        @if (recordForm.get('landInAcres')?.invalid && recordForm.get('landInAcres')?.touched) {
                        <mat-error>{{ translationService.get('errors.landRequired') }}</mat-error>
                        }
                    </mat-form-field>
                </div>

                <!-- Row 3: Rate & Total -->
                <div class="form-row">
                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.ratePerAcre') }}</mat-label>
                        <input matInput type="number" [placeholder]="translationService.get('form.ratePerAcrePlaceholder')" formControlName="ratePerAcre" step="100" required />
                        <mat-icon matPrefix>currency_rupee</mat-icon>
                        @if (recordForm.get('ratePerAcre')?.invalid && recordForm.get('ratePerAcre')?.touched) {
                        <mat-error>{{ translationService.get('errors.rateRequired') }}</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.totalAmount') }}</mat-label>
                        <input matInput type="number" [value]="totalPayment()" disabled class="calculated-input" />
                        <mat-icon matPrefix>calculate</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Row 4: Payment & Payment Date -->
                <div class="form-row">
                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.cashPayment') }}</mat-label>
                        <input matInput type="number" [placeholder]="translationService.get('form.cashPaymentPlaceholder')" formControlName="paidOnSight" step="100" />
                        <mat-icon matPrefix>wallet</mat-icon>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="form-field">
                        <mat-label>{{ translationService.get('form.paymentDate') }}</mat-label>
                        <input matInput [matDatepicker]="paymentDatePicker" formControlName="fullPaymentDate" [min]="minPaymentDate()" />
                        <mat-datepicker-toggle matSuffix [for]="paymentDatePicker"></mat-datepicker-toggle>
                        <mat-datepicker #paymentDatePicker></mat-datepicker>
                        <mat-icon matPrefix>schedule</mat-icon>
                    </mat-form-field>
                </div>

                <!-- Payment Summary -->
                <div class="payment-summary">
                    <div class="summary-row">
                        <span class="summary-label">{{ translationService.get('form.totalAmount') }}:</span>
                        <span class="summary-value">₹{{ totalPayment() | number: '1.0-0' }}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">{{ translationService.get('form.cashPayment') }}:</span>
                        <span class="summary-value">₹{{ recordForm.get('paidOnSight')?.value | number: '1.0-0' }}</span>
                    </div>
                    <div class="summary-row summary-pending">
                        <span class="summary-label">{{ translationService.get('records.pendingAmount') }}:</span>
                        <span class="summary-value" [class.pending-zero]="pendingPayment() <= 0">
              ₹{{ pendingPayment() | number: '1.0-0' }}
            </span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <button mat-raised-button color="primary" type="submit" class="save-btn" [disabled]="isSubmitting()">
                        @if (isSubmitting()) {
                            <mat-spinner diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
                            <span>{{ isEditMode() ? translationService.get('common.updating') : translationService.get('common.saving') }}</span>
                        } @else {
                            <ng-container>
                                <mat-icon>{{ isEditMode() ? 'update' : 'save' }}</mat-icon>
                                <span>{{ submitButtonText() }}</span>
                            </ng-container>
                        }
                    </button> @if (isEditMode()) {
                    <button mat-stroked-button type="button" (click)="cancelEdit()" class="cancel-btn" [disabled]="isSubmitting()">
                            <mat-icon>close</mat-icon>
                            <span>{{ translationService.get('common.cancel') }}</span>
                        </button> } @else {
                    <button mat-stroked-button type="button" (click)="resetForm()" class="clear-btn" [disabled]="isSubmitting()">
                            <mat-icon>clear</mat-icon>
                            <span>{{ translationService.get('common.clear') }}</span>
                        </button> }
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>
